{"version":3,"file":"factory.worker.js","sourceRoot":"","sources":["../../../../../dev/addons/src/navigation/factory/factory.worker.ts"],"names":[],"mappings":"AAOA,OAAO,EAAE,IAAI,IAAI,UAAU,EAAE,MAAM,yBAAyB,CAAC;AAE7D,OAAO,EAAE,MAAM,EAAE,uCAAyB;AAG1C,OAAO,EAAE,0BAA0B,EAAE,MAAM,oCAAoC,CAAC;AAEhF,OAAO,EAAE,yBAAyB,EAAE,MAAM,+BAA+B,CAAC;AAC1E,OAAO,EAAE,2BAA2B,EAAE,MAAM,yBAAyB,CAAC;AACtE,OAAO,EAAE,qBAAqB,EAAE,MAAM,0BAA0B,CAAC;AAEjE;;;;;;GAMG;AACH,MAAM,CAAC,KAAK,UAAU,iCAAiC;IACnD,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;QAC3B,MAAM,CAAC,KAAK,CAAC,yGAAyG,CAAC,CAAC;QACxH,OAAO,MAAM,2BAA2B,EAAE,CAAC,CAAC,sCAAsC;IACtF,CAAC;IAED,MAAM,UAAU,EAAE,CAAC;IAEnB,MAAM,MAAM,GAAG,IAAI,0BAA0B,EAAE,CAAC;IAEhD,wCAAwC;IACxC,MAAM,UAAU,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,qBAAqB,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,EAAE,IAAI,EAAE,wBAAwB,EAAE,CAAC,CAAC;IAC7G,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC;IAE3D,MAAM,CAAC,aAAa,GAAG,GAAG,EAAE;QACxB,MAAM,CAAC,IAAI,CAAC,gFAAgF,CAAC,CAAC;QAC9F,OAAO,IAAI,CAAC;IAChB,CAAC,CAAC;IAEF,MAAM,CAAC,kBAAkB,GAAG,KAAK,EAAE,MAAc,EAAE,UAAgC,EAAE,EAAE;QACnF,OAAO,MAAM,IAAI,OAAO,CAIrB,CAAC,OAAO,EAAE,OAAO,EAAE,EAAE;YACpB,yBAAyB,CAAC,MAAM,EAAE,UAAU,EAAE;gBAC1C,MAAM;gBACN,UAAU,EAAE,CAAC,OAAgB,EAAE,YAA0B,EAAE,SAAqB,EAAE,EAAE;oBAChF,OAAO,CAAC,EAAE,OAAO,EAAE,YAAY,EAAE,SAAS,EAAE,CAAC,CAAC;gBAClD,CAAC;aACJ,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC,CAAC;IAEF,OAAO,MAAM,CAAC;AAClB,CAAC","sourcesContent":["/**\n * IMPORTANT!\n * This file is still under construction and will change in the future.\n * Workers are not yet supported.\n * For more info visit: https://forum.babylonjs.com/t/replacing-recastjs-with-recast-navigation-js/56003/46\n */\nimport type { NavMesh, NavMeshQuery, TileCache } from \"@recast-navigation/core\";\nimport { init as initRecast } from \"@recast-navigation/core\";\n\nimport { Logger } from \"core/Misc/logger\";\nimport type { Mesh } from \"core/Meshes/mesh\";\n\nimport { RecastNavigationJSPluginV2 } from \"../plugin/RecastNavigationJSPlugin\";\nimport type { INavMeshParametersV2 } from \"../types\";\nimport { GenerateNavMeshWithWorker } from \"../generator/generator.worker\";\nimport { CreateNavigationPluginAsync } from \"./factory.single-thread\";\nimport { GenerateNavMeshWorker } from \"../worker/navmesh-worker\";\n\n/**\n * Creates a navigation plugin for the given scene using a worker.\n * @returns A promise that resolves to the created navigation plugin.\n * @remarks This function initializes the Recast module and sets up the navigation plugin to use a worker.\n * The worker is used to handle the creation of the navigation mesh asynchronously.\n * The `createNavMesh` method is not supported in worker mode, use `createNavMeshAsync` instead.\n */\nexport async function CreateNavigationPluginWorkerAsync() {\n    if (window && !window.Worker) {\n        Logger.Error(\"Web Workers are not supported in this environment. Please ensure your environment supports Web Workers.\");\n        return await CreateNavigationPluginAsync(); // Fallback to single-threaded version\n    }\n\n    await initRecast();\n\n    const plugin = new RecastNavigationJSPluginV2();\n\n    // Convert the worker function to a blob\n    const workerBlob = new Blob([`(${GenerateNavMeshWorker.toString()})()`], { type: \"application/javascript\" });\n    const worker = new Worker(URL.createObjectURL(workerBlob));\n\n    plugin.createNavMesh = () => {\n        Logger.Warn(\"createNavMesh is not supported in worker mode, use createNavMeshAsync instead.\");\n        return null;\n    };\n\n    plugin.createNavMeshAsync = async (meshes: Mesh[], parameters: INavMeshParametersV2) => {\n        return await new Promise<{\n            navMesh: NavMesh;\n            navMeshQuery: NavMeshQuery;\n            tileCache?: TileCache;\n        }>((resolve, _reject) => {\n            GenerateNavMeshWithWorker(meshes, parameters, {\n                worker,\n                completion: (navMesh: NavMesh, navMeshQuery: NavMeshQuery, tileCache?: TileCache) => {\n                    resolve({ navMesh, navMeshQuery, tileCache });\n                },\n            });\n        });\n    };\n\n    return plugin;\n}\n"]}