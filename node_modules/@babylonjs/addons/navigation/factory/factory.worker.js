import { init as initRecast } from "@recast-navigation/core";
import { Logger } from "@babylonjs/core/Misc/logger.js";
import { RecastNavigationJSPluginV2 } from "../plugin/RecastNavigationJSPlugin.js";
import { GenerateNavMeshWithWorker } from "../generator/generator.worker.js";
import { CreateNavigationPluginAsync } from "./factory.single-thread.js";
import { GenerateNavMeshWorker } from "../worker/navmesh-worker.js";
/**
 * Creates a navigation plugin for the given scene using a worker.
 * @returns A promise that resolves to the created navigation plugin.
 * @remarks This function initializes the Recast module and sets up the navigation plugin to use a worker.
 * The worker is used to handle the creation of the navigation mesh asynchronously.
 * The `createNavMesh` method is not supported in worker mode, use `createNavMeshAsync` instead.
 */
export async function CreateNavigationPluginWorkerAsync() {
    if (window && !window.Worker) {
        Logger.Error("Web Workers are not supported in this environment. Please ensure your environment supports Web Workers.");
        return await CreateNavigationPluginAsync(); // Fallback to single-threaded version
    }
    await initRecast();
    const plugin = new RecastNavigationJSPluginV2();
    // Convert the worker function to a blob
    const workerBlob = new Blob([`(${GenerateNavMeshWorker.toString()})()`], { type: "application/javascript" });
    const worker = new Worker(URL.createObjectURL(workerBlob));
    plugin.createNavMesh = () => {
        Logger.Warn("createNavMesh is not supported in worker mode, use createNavMeshAsync instead.");
        return null;
    };
    plugin.createNavMeshAsync = async (meshes, parameters) => {
        return await new Promise((resolve, _reject) => {
            GenerateNavMeshWithWorker(meshes, parameters, {
                worker,
                completion: (navMesh, navMeshQuery, tileCache) => {
                    resolve({ navMesh, navMeshQuery, tileCache });
                },
            });
        });
    };
    return plugin;
}
//# sourceMappingURL=factory.worker.js.map