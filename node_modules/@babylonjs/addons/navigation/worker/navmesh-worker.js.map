{"version":3,"file":"navmesh-worker.js","sourceRoot":"","sources":["../../../../../dev/addons/src/navigation/worker/navmesh-worker.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * IMPORTANT!\n * This file is still under construction and will change in the future.\n * Workers are not yet supported.\n * For more info visit: https://forum.babylonjs.com/t/replacing-recastjs-with-recast-navigation-js/56003/46\n */\nimport { exportNavMesh, exportTileCache, init as initRecast } from \"@recast-navigation/core\";\nimport type { SoloNavMeshGeneratorConfig, TileCacheGeneratorConfig, TiledNavMeshGeneratorConfig } from \"@recast-navigation/generators\";\nimport { generateSoloNavMesh, generateTileCache, generateTiledNavMesh } from \"@recast-navigation/generators\";\n\nimport { CreateSoloNavMeshConfig, CreateTileCacheNavMeshConfig } from \"../common/config\";\nimport type { INavMeshParametersV2 } from \"../types\";\n\n/**\n * Generates a navigation mesh in a web worker.\n */\nexport function GenerateNavMeshWorker() {\n    self.onmessage = async (event: {\n        /**\n         * The data sent to the worker.\n         */\n        data: {\n            /**\n             *  The positions of the vertices in the nav mesh.\n             */\n            positions: Float32Array;\n            /**\n             *  The indices of the vertices in the nav mesh.\n             */\n            indices: Uint32Array;\n            /**\n             *  The parameters used to configure the nav mesh generation.\n             */\n            parameters: INavMeshParametersV2;\n        };\n    }) => {\n        if (!event.data || !event.data.positions || !event.data.indices || !event.data.parameters) {\n            self.postMessage({ success: false, error: \"Invalid input data.\" });\n            return;\n        }\n\n        await initRecast();\n\n        const { positions, indices, parameters } = event.data;\n\n        // Decide on the type of nav mesh to generate based on parameters\n        // If tileSize is set, we will generate a tiled nav mesh\n        // If maxObstacles is set, we will generate a tile cache nav mesh\n        // Otherwise, we will generate a solo nav mesh\n        const needsTileCache = (parameters.maxObstacles ?? 0) > 0;\n        const needsTiledNavMesh = \"tileSize\" in parameters && (parameters.tileSize ?? 0) > 0;\n        const config = needsTileCache ? CreateTileCacheNavMeshConfig(parameters) : needsTileCache ? CreateTileCacheNavMeshConfig(parameters) : CreateSoloNavMeshConfig(parameters);\n\n        const result = needsTiledNavMesh\n            ? needsTileCache\n                ? generateTileCache(positions, indices, config as TileCacheGeneratorConfig)\n                : generateTiledNavMesh(positions, indices, config as TiledNavMeshGeneratorConfig)\n            : generateSoloNavMesh(positions, indices, config as SoloNavMeshGeneratorConfig);\n\n        if (!result.success || !result.navMesh) {\n            self.postMessage(result);\n            return;\n        }\n\n        // prepare the transferables\n        const transferables: Transferable[] = [];\n        const message: {\n            navMesh?: Uint8Array<ArrayBufferLike>;\n            tileCache?: Uint8Array<ArrayBufferLike>;\n        } = { navMesh: undefined, tileCache: undefined };\n\n        // If tile cache is present, serialize it and add to the message\n        if (\"tileCache\" in result && result.tileCache) {\n            if (result.tileCache) {\n                const tileCacheExport = exportTileCache(result.navMesh, result.tileCache);\n                message.tileCache = tileCacheExport;\n                transferables.push(tileCacheExport.buffer);\n            }\n        } else {\n            // otherwise send the NavMesh\n            const navMeshExport = exportNavMesh(result.navMesh);\n            message.navMesh = navMeshExport;\n            transferables.push(navMeshExport.buffer);\n        }\n\n        // send tansferable message\n        self.postMessage(message, { transfer: transferables });\n\n        // clean up\n        result.navMesh?.destroy();\n\n        if (\"tileCache\" in result && result.tileCache) {\n            result.tileCache.destroy();\n        }\n    };\n}\n"]}