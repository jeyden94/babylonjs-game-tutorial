{"version":3,"file":"generator.worker.js","sourceRoot":"","sources":["../../../../../dev/addons/src/navigation/generator/generator.worker.ts"],"names":[],"mappings":"AAWA,OAAO,EAAE,sBAAsB,EAAE,MAAM,mBAAmB,CAAC;AAC3D,OAAO,EAAE,oBAAoB,EAAE,sBAAsB,EAAE,MAAM,oBAAoB,CAAC;AAClF,OAAO,EAAE,iCAAiC,EAAE,MAAM,sBAAsB,CAAC;AAEzE;;;;;;GAMG;AACH,MAAM,UAAU,yBAAyB,CACrC,MAAmB,EACnB,UAAgC,EAChC,aAYC;IAED,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACtB,MAAM,IAAI,KAAK,CAAC,qDAAqD,CAAC,CAAC;IAC3E,CAAC;IAED,2DAA2D;IAC3D,aAAa,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC,EAAE,EAAE;QACnC,IAAK,CAAS,CAAC,IAAI,EAAE,OAAO,KAAK,KAAK,EAAE,CAAC;YACrC,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,EAAE,CAAC,CAAC;QACxD,CAAC;aAAM,CAAC;YACJ,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;YACtC,IAAI,SAAS,EAAE,CAAC;gBACZ,0FAA0F;gBAC1F,MAAM,cAAc,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC;gBACjD,MAAM,WAAW,GAAG,sBAAsB,CAAC,cAAc,EAAE,iCAAiC,EAAE,CAAC,CAAC;gBAChG,aAAa,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,EAAE,WAAW,CAAC,YAAY,EAAE,WAAW,CAAC,SAAS,CAAC,CAAC;gBAC/F,OAAO;YACX,CAAC;iBAAM,CAAC;gBACJ,IAAI,OAAO,EAAE,CAAC;oBACV,sDAAsD;oBACtD,MAAM,YAAY,GAAG,IAAI,UAAU,CAAC,OAAO,CAAC,CAAC;oBAC7C,MAAM,WAAW,GAAG,oBAAoB,CAAC,YAAY,CAAC,CAAC;oBACvD,aAAa,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,EAAE,WAAW,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBACnF,OAAO;gBACX,CAAC;YACL,CAAC;YAED,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,EAAE,CAAC,CAAC;QAClE,CAAC;IACL,CAAC,CAAC;IAEF,yBAAyB;IACzB,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,GAAG,sBAAsB,CAAC,MAAM,EAAE,EAAE,mBAAmB,EAAE,UAAU,CAAC,mBAAmB,EAAE,CAAC,CAAC;IACrH,MAAM,aAAa,GAAG,IAAI,YAAY,CAAC,SAAS,CAAC,CAAC;IAClD,MAAM,WAAW,GAAG,IAAI,WAAW,CAAC,OAAO,CAAC,CAAC;IAC7C,aAAa,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,SAAS,EAAE,aAAa,EAAE,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,EAAE,CAAC,aAAa,CAAC,MAAM,EAAE,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;AACjJ,CAAC","sourcesContent":["/**\n * IMPORTANT!\n * This file is still under construction and will change in the future.\n * Workers are not yet supported.\n * For more info visit: https://forum.babylonjs.com/t/replacing-recastjs-with-recast-navigation-js/56003/46\n */\nimport type { NavMeshQuery, NavMesh, TileCache } from \"@recast-navigation/core\";\n\nimport type { Mesh } from \"core/Meshes/mesh\";\n\nimport type { INavMeshParametersV2 } from \"../types\";\nimport { GetPositionsAndIndices } from \"../common/getters\";\nimport { BuildFromNavmeshData, BuildFromTileCacheData } from \"./generator.common\";\nimport { CreateDefaultTileCacheMeshProcess } from \"../common/tile-cache\";\n\n/**\n * Builds a NavMesh and NavMeshQuery from meshes using provided parameters.\n * @param meshes The array of meshes used to create the NavMesh.\n * @param parameters The parameters used to configure the NavMesh generation.\n * @param workerOptions Options for the worker, including a completion callback and the worker instance.\n * @throws Error if the NavMesh data is invalid or cannot be deserialized.\n */\nexport function GenerateNavMeshWithWorker(\n    meshes: Array<Mesh>,\n    parameters: INavMeshParametersV2,\n    workerOptions: {\n        /**\n         * Completion callback that is called when the NavMesh generation is complete.\n         * @param navMesh The generated NavMesh.\n         * @param navMeshQuery The NavMeshQuery associated with the generated NavMesh.\n         * @param tileCache Optional TileCache if tile cache generation was used.\n         */\n        completion: (navMesh: NavMesh, navMeshQuery: NavMeshQuery, tileCache?: TileCache) => void;\n        /**\n         *  Worker instance used for asynchronous NavMesh generation.\n         */\n        worker: Worker;\n    }\n) {\n    if (meshes.length === 0) {\n        throw new Error(\"At least one mesh is needed to create the nav mesh.\");\n    }\n\n    // callback function to process the message from the worker\n    workerOptions.worker.onmessage = (e) => {\n        if ((e as any).data?.success === false) {\n            throw new Error(`Unable to generate navMesh: ${e}`);\n        } else {\n            const { navMesh, tileCache } = e.data;\n            if (tileCache) {\n                // if tileCache is present, the binary data contains the navmesh and the tilecache as well\n                const tileCacheArray = new Uint8Array(tileCache);\n                const navMeshData = BuildFromTileCacheData(tileCacheArray, CreateDefaultTileCacheMeshProcess());\n                workerOptions.completion(navMeshData.navMesh, navMeshData.navMeshQuery, navMeshData.tileCache);\n                return;\n            } else {\n                if (navMesh) {\n                    // deserialize the navmesh only (no tilecache present)\n                    const navMeshArray = new Uint8Array(navMesh);\n                    const navMeshData = BuildFromNavmeshData(navMeshArray);\n                    workerOptions.completion(navMeshData.navMesh, navMeshData.navMeshQuery, undefined);\n                    return;\n                }\n            }\n\n            throw new Error(`Unable to generate navMesh/tileCache: ${e}`);\n        }\n    };\n\n    // send message to worker\n    const [positions, indices] = GetPositionsAndIndices(meshes, { doNotReverseIndices: parameters.doNotReverseIndices });\n    const positionsCopy = new Float32Array(positions);\n    const indicesCopy = new Uint32Array(indices);\n    workerOptions.worker.postMessage({ positions: positionsCopy, indices: indicesCopy, parameters }, [positionsCopy.buffer, indicesCopy.buffer]);\n}\n"]}